#include<stdio.h>
#include<conio.h>
#include<string.h>
#include<ctype.h>
#include<stdbool.h>

FILE *fo,*fg;

void kayit_ekle();
void kayit_listele();
void kayit_sil();
void kayit_guncelle();
void kayit_noara();
void kayit_adara();

struct ogrenci
{
	int no,durum;
	char ad[10];
	char soyad[10];
};

  struct ogrenci ogr,gec;
  
  
 
  int main()
  {
  	int secin,tus;
  	do
	  {
	  	printf("MENU");
  		printf("\n\n");
  		printf("[1]-kayit ekle\n");
  		printf("[2]-kayit listeleme\n");
  		printf("[3]-kayit silme\n");
  		printf("[4]-kayit guncelleme\n");
  		printf("[5]-kayit numara arama\n");
  		printf("[6]-kayit isim arama\n");
  		printf("\n");
  		printf ("yapmak istediginiz secim giriniz:");
  		scanf("%d",&secin);
  		
  		switch(secin)
  		{
  			case 1 :kayit_ekle(); break;
  			case 2 :kayit_listele(); break;
  			case 3 :kayit_sil(); break;
  			case 4 :kayit_guncelle(); break;
  			case 5 :kayit_noara(); break;
  			case 6 :kayit_adara(); break;
  		
  			default : printf ("lutfen 1-7 arasi bisey girin :P \n\n"); break;
		  }
		  
		  printf("cikmak icin 8 girin menuye donmek icin bir sayi basin\n\n");
		  scanf("%d",&tus);
		  
	  } while(tus!=8);
	  return 0;
  }
  
  
 
 
  void kayit_ekle()
  {
  	
  	
  	int no;
  	fo=fopen("E:\\ogrenci.txt","r");
  	
  	printf("ogrenci numarasi girin:");
  	scanf ("%d",&ogr.no);
  	
  	while(fscanf(fo,"%d %s %s %d",&gec.no,gec.ad,gec.soyad,&gec.durum)!=EOF)
  	{
  		if(ogr.no==gec.no && gec.durum==1)
  		{
  			printf ("bu kayitta birisi mevcut baska no girin \n");
  			fclose(fo);
  			return;
		  }
	  }
	 
	  fclose(fo);
	  fo=fopen("E:\\ogrenci.txt","r+");
	  fg=fopen("E:\\gecici.txt","w+");
	  printf ("ogrencinin adini girin(EN FAZLA 10 KARAKTER GİRİN): ");
	  scanf("%s",ogr.ad);
	  printf("ogrencinin soyadini girin(EN FAZLA 10 KARAKTER GİRİN): ");
	  scanf("%s",ogr.soyad);
	  if(strlen(ogr.ad)>=10 || strlen(ogr.soyad)>=10)
	  {
	  	printf("fazla karekter girildi\n\n");return;
	  }
	  
	  int yazildi=0;
	  while (fscanf(fo,"%d %s %s %d",&gec.no,gec.ad,gec.soyad,&gec.durum)!=EOF)
	  {
	  		if(strcmp(ogr.ad,gec.ad)<0 && yazildi==0)//rotana-busra
	  		{
	  			fprintf(fg,"%d %s %s 1\n",ogr.no,ogr.ad,ogr.soyad);
	  			yazildi=1;
	  			
			  }
			  fprintf(fg,"%d %s %s %d\n",gec.no,gec.ad,gec.soyad,gec.durum);
	  }
	  if(yazildi==0)
	  {
	  	fprintf(fg,"%d %s %s 1\n",ogr.no,ogr.ad,ogr.soyad);
	  }
	  printf("\n\n");
	  printf("..KAYİT EKLENDİ..\n\n");
	  fclose(fo);
	  fclose(fg);
	  remove("E:\\ogrenci.txt");
	  rename("E:\\gecici.txt","E:\\ogrenci.txt");
	  } 
	  
	  
	  
	  	  
	   void kayit_listele()
	  {
	  	fo=fopen("E:\\ogrenci.txt","r");
	  	while(fscanf(fo,"%d %s %s %d",&ogr.no,ogr.ad,ogr.soyad,&ogr.durum)!=EOF)
	  	{
	  		if(ogr.durum!=0)
	  		printf("NO:%8d AD:%8s SOYAD:%8s\n",ogr.no,ogr.ad,ogr.soyad);
	  		
		  }
		  fclose(fo);
		  
	  }
	  
	  
	  
	  void kayit_sil()
	  {
	  	bool kayitVarmi=false;
	  	int sayi;
	  	fo=fopen("E:\\ogrenci.txt","r");
	  	fg=fopen("E:\\gecici.txt","w+");
	  	printf("silmek istediginiz kayit nosunu girin: \n");
	  	scanf("%d",&sayi);
	  	
	  	
	  	while((fscanf(fo,"%d %s %s %d",&ogr.no,ogr.ad,ogr.soyad,&ogr.durum))!=EOF);
	  	{
	  		
	  		if(ogr.no==sayi && ogr.durum==1)
	  		{
	  			kayitVarmi=true;
	  			fprintf(fg,"%d %s %s 0\n",ogr.no,ogr.ad,ogr.soyad);
	  			}
				  else
				  {
				  	fprintf(fg,"%d %s %s %d\n",ogr.no,ogr.ad,ogr.soyad,ogr.durum);
				  }
				  }
		  if(kayitVarmi==false)
		  {
		  	printf("aradiginiz kayit bulunamadi..!");
		  }
		  printf("kayit silindi..\n");
		  
		  fclose(fo);
		  fclose(fg);
		  remove("E:\\ogrenci.txt");
		  rename("E:\\gecici.txt","E:\\ogrenci.txt");
	  }
	  
	  
	  
	  void kayit_guncelle()
	  {
	  	int sayi;
	  	
	  	
	  	fo=fopen("E:\\ogrenci.txt","r");
	  	fg=fopen("E:\\gecici.txt","w+");
	  	printf("guncellemek istediginiz kayit nosunu girin: ");
	  	scanf("%d",&sayi);
	  	printf("yeni adi girin: ");
	  	scanf("%s",gec.ad);
	  	printf("yeni soyadi girin: ");
	  	scanf("%s",&gec.soyad);
	  			int yazildi=1;
	  			while(fscanf(fo,"%d %s %s %d",&ogr.no,ogr.ad,ogr.soyad,&ogr.durum)!=EOF)
	  			{
	  				if(ogr.no==sayi && ogr.durum==1)
	  				continue;
	  				
	  				if(strcmp(gec.ad,ogr.ad)<0 && yazildi==1)
	  				{
	  					fprintf(fg,"%d %s %s 1\n",sayi,gec.ad,gec.soyad);
	  					yazildi=0;
					  }
					  fprintf(fg,"%d %s %s %d\n",ogr.no,ogr.ad,ogr.soyad,ogr.durum);
				  }
				  if(yazildi==1)
				  {
				  	fprintf(fg,"%d %s %s 1\n",sayi,gec.ad,gec.soyad);
				  	yazildi=0;
				  }
				  printf("\n\n");
				  printf("...KAYİT GUNCELLENDİ...\n\n");
				  fclose(fo);
				  fclose(fg);
				  remove("E:\\ogrenci.txt");
				  rename("E:\\gecici.txt","E:\\ogrenci.txt");
	  }
	  
	  
	  
	  
	  void kayit_noara()
	  {
	  	int aranansayi;
	  	bool bulundumu=false;
	  	fo=fopen("E:\\ogrenci.txt","r");
	  	printf("aramak istediginiz kayit nosunu girin: \n ");
	  	scanf("%d",&aranansayi);
	  	while((fscanf(fo,"%d %s %s %d",&ogr.no,ogr.ad,ogr.soyad,&ogr.durum))!=EOF)
	  	{
	  		
	  		if(ogr.no==aranansayi && ogr.durum==1)
	  		{
	  			bulundumu=true;
	  			printf("no:%d  ad:%s  soyad:%s  \n\n",ogr.no,ogr.ad,ogr.soyad);
	  			return;
			  }
			  
		  }
		  
		  bulundumu=false;
		  printf("aradiginiz kayit bulunamadi!!\n\n");
		  fclose(fo);
		  
	  }
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  void kayit_adara()
	  {
	  	int i;
	  	char dizi [30];
	  	int b=0,a=0;
	  	
	  	printf ("aramak istediginiz kayit adini girin(EN FAZLA 10 KARAKTER): \n");
	  	scanf("%s",dizi);
	  	
	  	
	  	fo=fopen("E:\\ogrenci.txt","r");
	  	while(fscanf(fo,"%d %s %s %d",&ogr.no,ogr.ad,ogr.soyad,&ogr.durum)!=EOF)
	  	{
	  		if(ogr.durum==1)
	  		{
	  			b=0;
	  			for(i=0;i<strlen(ogr.ad);i++)
	  			{
	  				if((dizi[a]!=(ogr.ad[b])))
	  				{
	  					a=0;
	  					b++;
	  					
					  }
					  else
					  {
					  	if(a==(strlen(dizi)-1))
					  	{
					  		printf("no:%4d ad:%5s soyad:%6s\n\n",ogr.no,ogr.ad,ogr.soyad);
					  		break;
						  }
						  else
						  {
						  	b++;
						  	a++;
						  }
					  }
					  
				  }
				  
			  }
		  
		  }
		  
		  fclose(fo);
		  getch();
}

	  